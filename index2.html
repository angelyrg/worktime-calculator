<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculadora de Horas Trabajadas</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

</head>

<body style="height: 100vh;" >

    <div class="container h-100 d-flex justify-content-end">
        <div class="card shadow rounded-4  my-auto" style="max-width: 500px; ">
            <div class="card-body">
                <div class="row">
                    <div class="col-4 d-flex flex-column text-center">
                        <span>Ingreso</span>
                        <input type="time" class="form-control w-100" id="horaEntradaDefault" value="09:00">
                    </div>
                    <div class="col-4 text-center">
                        <span>Ingreso</span>
                        <input type="time" class="form-control w-100" id="horaSalidaDefault" value="10:00">
                    </div>
                    <div class="col-4">
                        <span>Ingreso</span>
                        <input type="time" class="form-control w-100" id="descanso" value="60:00">
                    </div>
                </div>
                
                <label for="pagoPorHora">Pago por Hora:</label>
                <input type="number" id="pagoPorHora" value="10">
            
                <button id="seleccionarFechas">Seleccionar Fechas</button>
                <div id="fechasSeleccionadasContainer"></div>
            
            
                <button id="calcularHoras">Calcular Horas Trabajadas</button>
            
                <div id="resultado"></div>

            </div>
        </div>
    </div>
    


    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
    <script src="https://cdn.jsdelivr.net/npm/dayjs/dayjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            let fechasSeleccionadas = {};
            let entradaDefault = document.getElementById('horaEntradaDefault').value;
            let salidaDefault = document.getElementById('horaSalidaDefault').value;

            // Actualización del manejo de cambio para las horas predeterminadas
            document.getElementById('horaEntradaDefault').addEventListener('change', function () {
                entradaDefault = this.value;
            });

            document.getElementById('horaSalidaDefault').addEventListener('change', function () {
                salidaDefault = this.value;
            });

            document.getElementById('seleccionarFechas').addEventListener('click', () => {
                flatpickr("#fechasSeleccionadasContainer", {
                    mode: "multiple",
                    dateFormat: "Y-m-d",
                    enableTime: false,
                    defaultDate: Object.keys(fechasSeleccionadas),
                    onClose: function (selectedDates) {
                        const fechasActualizadas = {};
                        selectedDates.forEach((date) => {
                            const dateString = date.toISOString().substring(0, 10);
                            fechasActualizadas[dateString] = fechasSeleccionadas[dateString] || {
                                entrada: entradaDefault,
                                salida: salidaDefault
                            };
                        });
                        fechasSeleccionadas = fechasActualizadas;
                        actualizarUIFechas();
                        calcularHorasYTotal(); // Mover el cálculo aquí
                    }
                }).open();
            });

            

            // Se reutilizan las funciones agregarCamposFecha, actualizarUIFechas sin cambios
            function actualizarUIFechas() {
                const container = document.getElementById('fechasSeleccionadasContainer');
                container.innerHTML = ''; // Limpiar el contenedor
                Object.entries(fechasSeleccionadas).forEach(([fecha, horas]) => {
                    agregarCamposFecha(fecha, horas);
                });
            }

            function agregarCamposFecha(fecha, horas) {
                const container = document.getElementById('fechasSeleccionadasContainer');
                const div = document.createElement('div');
                div.innerHTML = `
                    <div class="fecha-group">
                        <label>${fecha}</label>
                        <input type="time" value="${horas.entrada}" class="horaEntradaEspecifica" data-fecha="${fecha}">
                        <input type="time" value="${horas.salida}" class="horaSalidaEspecifica" data-fecha="${fecha}">
                    </div>
                `;
                container.appendChild(div);

                div.querySelector('.horaEntradaEspecifica').addEventListener('change', function() {
                    fechasSeleccionadas[this.dataset.fecha].entrada = this.value;
                });

                div.querySelector('.horaSalidaEspecifica').addEventListener('change', function() {
                    fechasSeleccionadas[this.dataset.fecha].salida = this.value;
                });
            }

            // Modifica esta función para calcular también el total a pagar
            function calcularHorasYTotal() {
                let totalHoras = 0;
                const pagoPorHora = parseFloat(document.getElementById('pagoPorHora').value);
                Object.keys(fechasSeleccionadas).forEach(fecha => {
                    const horas = fechasSeleccionadas[fecha];
                    const entrada = dayjs(`${fecha}T${horas.entrada}`);
                    const salida = dayjs(`${fecha}T${horas.salida}`);
                    const diferencia = salida.diff(entrada, 'hour', true);
                    totalHoras += diferencia;
                });
                const totalAPagar = totalHoras * pagoPorHora;
                document.getElementById('resultado').textContent = `Total horas trabajadas: ${totalHoras.toFixed(2)} horas. Total a pagar: $${totalAPagar.toFixed(2)}`;
            }
        });

    </script>
</body>

</html>